---
description: åœ–ç‰‡ç”Ÿæˆè¦ç¯„ï¼ŒåŒ…å« Canvas æ“ä½œå’Œå“ç‰Œè¨­è¨ˆæ¨™æº–
globs: backend/src/services/imageGenerator.js
alwaysApply: false
---

# åœ–ç‰‡ç”Ÿæˆè¦ç¯„

## ğŸ¨ æ ¸å¿ƒåŸå‰‡

1. **ä½¿ç”¨é«˜è§£æåº¦**ï¼ˆ10x scaleï¼Œå¯¦éš› 5000x5000ï¼‰
2. **å­—é«”å¿…é ˆæ”¯æ´ç¹é«”ä¸­æ–‡**
3. **é¡è‰²éµå¾ªå“ç‰Œè¦ç¯„**ï¼ˆ#3B6E98ã€#D2D2D2ï¼‰
4. **åœ–ç‰‡å°ºå¯¸å›ºå®šç‚º 500x500**ï¼ˆé‚è¼¯å°ºå¯¸ï¼‰

## ğŸ“ Canvas è¨­å®š

### é«˜è§£æåº¦è¨­å®š

```javascript
// âœ… GOOD - ä½¿ç”¨ scale æé«˜è§£æåº¦
const scale = 10;
const canvasSize = 500;
const canvas = createCanvas(canvasSize * scale, canvasSize * scale);
const ctx = canvas.getContext('2d');
ctx.scale(scale, scale);

// ç¹ªè£½æ™‚ä½¿ç”¨é‚è¼¯å°ºå¯¸
ctx.fillRect(0, 0, canvasSize, canvasSize);  // å¯¦éš›ç¹ªè£½ 5000x5000

// âŒ BAD - ç›´æ¥ä½¿ç”¨ä½è§£æåº¦
const canvas = createCanvas(500, 500);  // åœ–ç‰‡æœƒæ¨¡ç³Š
```

## ğŸ¨ å“ç‰Œé…è‰²

### é¡è‰²å¸¸æ•¸

```javascript
// âœ… GOOD - å®šç¾©é¡è‰²å¸¸æ•¸
const COLORS = {
  background: '#D2D2D2',      // èƒŒæ™¯ç°
  pieceBackground: '#FFFFFF', // æ£‹å­èƒŒæ™¯ç™½
  red: '#FF0000',             // ç´…æ£‹
  black: '#000000',           // é»‘æ£‹
  text: '#000000'             // æ–‡å­—é»‘
};

// âŒ BAD - ç¡¬ç·¨ç¢¼é¡è‰²
ctx.fillStyle = '#cccccc';  // ä¸ç¬¦åˆå“ç‰Œè¦ç¯„
```

### æ£‹å­é¡è‰²åˆ¤æ–·

```javascript
// âœ… GOOD - æ¸…æ¥šçš„æ£‹å­åˆ†é¡
const RED_PIECES = ['å¸¥', 'ä»•', 'ç›¸', 'ä¿¥', 'å‚Œ', 'ç‚®', 'å…µ'];
const BLACK_PIECES = ['å°‡', 'å£«', 'è±¡', 'è»Š', 'é¦¬', 'åŒ…', 'å’'];

const isRed = RED_PIECES.includes(piece.name);
ctx.strokeStyle = isRed ? COLORS.red : COLORS.black;
```

## ğŸ”¤ å­—é«”è™•ç†

### ç¹é«”ä¸­æ–‡å­—é«”

```javascript
// âœ… GOOD - æŒ‡å®šæ”¯æ´ç¹é«”ä¸­æ–‡çš„å­—é«”
ctx.font = 'bold 50px "Microsoft YaHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif';

// âŒ BAD - ä¸æŒ‡å®šå­—é«”ï¼Œå¯èƒ½ç„¡æ³•é¡¯ç¤ºä¸­æ–‡
ctx.font = '50px serif';
```

### æ–‡å­—æ›è¡Œè™•ç†

```javascript
// âœ… GOOD - å¯¦ä½œæ–‡å­—æ›è¡Œ
function drawWrappedText(ctx, text, x, y, maxWidth, lineHeight) {
  const characters = text.split('');
  let line = '';
  let yOffset = y;

  for (let i = 0; i < characters.length; i++) {
    const testLine = line + characters[i];
    const metrics = ctx.measureText(testLine);
    
    if (metrics.width > maxWidth && i > 0) {
      ctx.fillText(line, x, yOffset);
      line = characters[i];
      yOffset += lineHeight;
    } else {
      line = testLine;
    }
  }
  
  ctx.fillText(line, x, yOffset);
}
```

## ğŸ¯ æ£‹å­ç¹ªè£½

### åå­—æ’åˆ—ä½ç½®

```javascript
// âœ… GOOD - æ¸…æ¥šçš„ä½ç½®å®šç¾©
const positions = [
  { x: 250, y: 300, label: 'ä¸­' },  // æ£‹å­1ï¼ˆä¸­å¿ƒï¼‰
  { x: 130, y: 300, label: 'å·¦' },  // æ£‹å­2ï¼ˆå·¦å´ï¼‰
  { x: 370, y: 300, label: 'å³' },  // æ£‹å­3ï¼ˆå³å´ï¼‰
  { x: 250, y: 180, label: 'ä¸Š' },  // æ£‹å­4ï¼ˆä¸Šæ–¹ï¼‰
  { x: 250, y: 420, label: 'ä¸‹' }   // æ£‹å­5ï¼ˆä¸‹æ–¹ï¼‰
];
```

### æ£‹å­ç¹ªè£½æ¨™æº–

```javascript
// âœ… GOOD - å®Œæ•´çš„æ£‹å­ç¹ªè£½
function drawPiece(ctx, piece, x, y) {
  const radius = 45;
  const isRed = RED_PIECES.includes(piece.name);
  
  // 1. ç¹ªè£½åœ“å½¢èƒŒæ™¯
  ctx.beginPath();
  ctx.arc(x, y, radius, 0, 2 * Math.PI);
  ctx.fillStyle = COLORS.pieceBackground;
  ctx.fill();
  
  // 2. ç¹ªè£½é‚Šæ¡†ï¼ˆ3pxï¼‰
  ctx.strokeStyle = isRed ? COLORS.red : COLORS.black;
  ctx.lineWidth = 3;
  ctx.stroke();
  
  // 3. ç¹ªè£½æ£‹å­æ–‡å­—
  ctx.font = 'bold 50px "Microsoft YaHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillStyle = isRed ? COLORS.red : COLORS.black;
  ctx.fillText(piece.name, x, y + 3);  // +3 å¾®èª¿å‚ç›´å°é½Š
}
```

## ğŸ“ å°ºå¯¸è¦æ ¼

| å…ƒç´  | é‚è¼¯å°ºå¯¸ | å¯¦éš›å°ºå¯¸ | èªªæ˜ |
|------|----------|----------|------|
| ç•«å¸ƒ | 500x500 | 5000x5000 | scale=10 |
| æ£‹å­åŠå¾‘ | 45px | 450px | åœ“å½¢ |
| æ£‹å­é‚Šæ¡† | 3px | 30px | ç´…/é»‘ |
| æ£‹å­æ–‡å­— | 50px | 500px | ç²—é«” |
| å•é¡Œæ–‡å­— | 35px | 350px | ç²—é«” |
