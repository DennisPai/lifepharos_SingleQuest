---
description: n8n å·¥ä½œæµé–‹ç™¼è¦ç¯„ï¼ŒåŒ…å« webhookã€Function ç¯€é»å’Œ Google Sheets æ“ä½œ
globs: n8n_workflows/**/*.json
alwaysApply: false
---

# n8n å·¥ä½œæµé–‹ç™¼è¦ç¯„

## âœ… æ ¸å¿ƒåŸå‰‡

1. **æ¯å€‹ webhook å¿…é ˆåŒ…å«éŒ¯èª¤è™•ç†**
2. **Function ç¯€é»å¿…é ˆåŒ…å«è¨»è§£èªªæ˜**
3. **é¿å…ç›´æ¥æ›´æ–° Google Sheets å…¬å¼æ¬„ä½**
4. **Webhook è·¯å¾‘ä½¿ç”¨èªç¾©åŒ–å‘½å**

## ğŸ”Œ Webhook è¨­å®š

### èªç¾©åŒ–è·¯å¾‘å‘½å

```json
// âŒ BAD - ä½¿ç”¨éš¨æ©Ÿ UUID
{
  "path": "370e0a71-244b-426a-9485-4237f0178e71"
}

// âœ… GOOD - ä½¿ç”¨èªç¾©åŒ–åç¨±
{
  "path": "get-board"  // æ¸…æ¥šè¡¨é”ç”¨é€”
}
```

## ğŸ“ Function ç¯€é»

### å¿…é ˆåŒ…å«è¨»è§£

```javascript
// âŒ BAD - æ²’æœ‰è¨»è§£
const positions = items[0].json.body.positions;
return [{ json: { P: positions[0] } }];

// âœ… GOOD - æ¸…æ¥šçš„è¨»è§£
/**
 * æº–å‚™æ›´æ–°è³‡æ–™
 * å°‡å‰ç«¯å‚³ä¾†çš„ positions é™£åˆ—å°æ‡‰åˆ° Google Sheets çš„ P-T æ¬„ä½
 */
const positions = items[0].json.body.positions;
const rowNumber = items[0].json.row;

return [{
  json: {
    rowNumber: rowNumber,
    updates: {
      'P': positions[0],  // æ£‹å­é †åº1
      'Q': positions[1],  // æ£‹å­é †åº2
      'R': positions[2],  // æ£‹å­é †åº3
      'S': positions[3],  // æ£‹å­é †åº4
      'T': positions[4]   // æ£‹å­é †åº5
    }
  }
}];
```

## ğŸ“Š Google Sheets æ“ä½œ

### åªæ›´æ–°è³‡æ–™æ¬„ä½ï¼Œä¸å‹•å…¬å¼æ¬„ä½

```json
// âœ… GOOD - åªæ›´æ–° P-T æ¬„ä½
{
  "operation": "update",
  "columns": {
    "value": {
      "æ£‹å­é †åº1": "={{ $json.updates.P }}",
      "æ£‹å­é †åº2": "={{ $json.updates.Q }}"
    }
  }
}

// âŒ BAD - æ›´æ–°å…¬å¼æ¬„ä½
{
  "columns": {
    "value": {
      "å·²ä½¿ç”¨": "TRUE",  // D æ¬„æœ‰å…¬å¼ï¼Œä¸æ‡‰ç›´æ¥æ›´æ–°
      "çµæœ": "å£«ã€ç‚®ã€ç›¸ã€å¸¥ã€å£«"  // Z æ¬„æœ‰å…¬å¼ï¼Œä¸æ‡‰ç›´æ¥æ›´æ–°
    }
  }
}
```

**åŸå› **ï¼š
- ã€Œå·²ä½¿ç”¨ã€æ¬„ä½ï¼ˆDæ¬„ï¼‰å…¬å¼ï¼š`=IF(Z13="","")`
- ã€Œçµæœã€æ¬„ä½ï¼ˆZæ¬„ï¼‰å…¬å¼ï¼š`=IFERROR(U13&"ã€"&V13&"ã€"&W13&"ã€"&X13&"ã€"&Y13,"")`
- ç›´æ¥æ›´æ–°æœƒè¦†è“‹å…¬å¼ï¼Œå°è‡´é‚è¼¯éŒ¯èª¤

### æŸ¥è©¢å‰é©—è­‰ taskId æ ¼å¼

```javascript
// âœ… GOOD - Function ç¯€é»é©—è­‰ taskId
const taskId = $json.body.taskId;

// é©—è­‰æ ¼å¼ï¼šID{timestamp}
if (!taskId || !taskId.startsWith('ID')) {
  return [{
    json: {
      success: false,
      error: 'Invalid task ID format'
    }
  }];
}
```
