# 設計規格文檔 - 象棋卜卦 LIFF 應用

## 視覺設計

### 設計參考

參考專案：[DennisPai/chinesechessdivination_singlequestion](https://github.com/DennisPai/chinesechessdivination_singlequestion)

### 品牌配色

| 用途 | 顏色代碼 | 說明 |
|------|----------|------|
| 主色調 | `#3B6E98` | 深藍色，用於標題、按鈕 |
| 背景色 | `#D2D2D2` | 淺灰色，用於圖片背景 |
| 次要背景 | `#F5F5F5` | 極淺灰，用於卡片背景 |
| 文字主色 | `#333333` | 深灰，用於正文 |
| 文字次色 | `#666666` | 中灰，用於說明文字 |
| 紅棋顏色 | `#FF0000` | 紅色，帥仕相俥傌炮兵 |
| 黑棋顏色 | `#000000` | 黑色，將士象車馬包卒 |

### 棋子對照表

**紅棋（7 種）**:
- 帥、仕、相、俥、傌、炮、兵

**黑棋（7 種）**:
- 將、士、象、車、馬、包、卒

---

## LIFF 頁面設計

### 頁面流程

```
開始
  ↓
【檢查頁面】Loading...
  ↓
已使用？
  ├─ 是 → 【已使用頁面】顯示之前的結果
  └─ 否 → 【輸入問題頁面】
            ↓
         【輸入數字頁面】
            ↓
         【處理中頁面】Loading...
            ↓
         【結果顯示頁面】
```

### 頁面一：檢查頁面（STATE_CHECKING）

**佈局**:
```
┌─────────────────────┐
│                     │
│   ⏳ Loading...     │
│   正在檢查資料...    │
│                     │
└─────────────────────┘
```

**元素**:
- Loading 動畫（CSS 或 GIF）
- 文字："正在檢查資料..."
- 背景：白色

### 頁面二：輸入問題頁面（STATE_INPUT_QUESTION）

**佈局**:
```
┌─────────────────────────────┐
│  📝 請輸入您的問題           │
│  ────────────────────        │
│                             │
│  ┌─────────────────────┐    │
│  │ 問題輸入框          │    │
│  │ (最多30字)          │    │
│  └─────────────────────┘    │
│                             │
│  字數：0/30                  │
│                             │
│  【下一步】                  │
└─────────────────────────────┘
```

**元素**:
- 標題："請輸入您的問題"（字體大、粗體、#3B6E98）
- 分隔線
- 輸入框：
  - type="text"
  - placeholder="請輸入您想問的問題..."
  - maxlength="30"
  - 邊框顏色：#3B6E98
- 字數計數器："0/30"（即時更新）
- 按鈕：
  - 文字："下一步"
  - 背景：#3B6E98
  - 文字：白色
  - 圓角：8px
  - 禁用狀態：問題為空時灰色

### 頁面三：輸入數字頁面（STATE_INPUT_NUMBERS）

**佈局**:
```
┌─────────────────────────────┐
│  🎲 請選擇 5 個數字          │
│  ────────────────────        │
│                             │
│  請輸入5個數字，用逗號分隔   │
│  (例如：9,19,21,23,32)       │
│                             │
│  ┌─────────────────────┐    │
│  │ 數字輸入框          │    │
│  └─────────────────────┘    │
│                             │
│  [可選] 參考棋盤圖片         │
│                             │
│  【返回】     【開始抽卦】    │
└─────────────────────────────┘
```

**元素**:
- 標題："請選擇 5 個數字"（#3B6E98）
- 說明文字：
  - "請輸入5個數字，用逗號分隔"
  - "(例如：9,19,21,23,32)"
  - 顏色：#666666
- 輸入框：
  - type="text"
  - placeholder="9,19,21,23,32"
  - 即時驗證並顯示錯誤
- 參考圖片（可選）：
  - 顯示棋盤數字圖
  - 靜態圖片，不可點擊
- 按鈕組：
  - 返回按鈕（左）：背景 #999999
  - 開始抽卦按鈕（右）：背景 #3B6E98
  - 禁用狀態：數字驗證失敗時

**驗證規則顯示**:
- ✅ 正確：綠色勾
- ❌ 錯誤：紅色叉 + 錯誤訊息
  - "必須正好 5 個數字"
  - "數字範圍 1-32"
  - "數字不可重複"
  - "格式錯誤，請用逗號分隔"

### 頁面四：處理中頁面（STATE_PROCESSING）

**佈局**:
```
┌─────────────────────┐
│                     │
│   🔮 Loading...     │
│   正在為您排卦...    │
│   請稍候...         │
│                     │
└─────────────────────┘
```

**元素**:
- Loading 動畫
- 文字：
  - "正在為您排卦..."
  - "請稍候..."
- 背景：白色

### 頁面五：結果顯示頁面（STATE_RESULT）

**佈局**:
```
┌─────────────────────────────┐
│  ✨ 以下是您抽到的卦          │
│  ────────────────────        │
│                             │
│      【圖】     【圖】        │
│         ┌─────────┐         │
│  【圖】 │  【圖】  │ 【圖】   │
│         └─────────┘         │
│                             │
│  您的問題：今年事業運如何？   │
│                             │
│  老師將於24小時內回覆您       │
│                             │
│  【完成】                    │
└─────────────────────────────┘
```

**元素**:
- 標題："以下是您抽到的卦"（#3B6E98）
- 卦象展示：
  - 十字排列（5 個棋子）
  - 位置：上、中、下、左、右
  - 棋子樣式：
    - 白色圓形背景
    - 紅/黑邊框（3px）
    - 紅/黑文字（50px 粗體）
    - 圓形半徑：45px
- 問題顯示：
  - "您的問題：{question}"
  - 顏色：#333333
  - 支援換行（長文字）
- 說明文字：
  - "老師將於24小時內回覆您"
  - 顏色：#666666
- 完成按鈕：
  - 文字："完成"
  - 背景：#3B6E98
  - 點擊後執行 `liff.closeWindow()`

### 頁面六：已使用頁面（STATE_ALREADY_USED）

**佈局**:
```
┌─────────────────────────────┐
│  ℹ️ 該問題您已抽卦            │
│  ────────────────────        │
│                             │
│  以下是您之前的抽卦結果：      │
│                             │
│      【圖】     【圖】        │
│         ┌─────────┐         │
│  【圖】 │  【圖】  │ 【圖】   │
│         └─────────┘         │
│                             │
│  您的問題：{question}         │
│                             │
│  【回到聊天室】              │
└─────────────────────────────┘
```

**元素**:
- 標題："該問題您已抽卦"（#FF9800 橘色）
- 說明："以下是您之前的抽卦結果："
- 之前的卦象展示（同結果頁面）
- 問題顯示
- 回到聊天室按鈕：
  - 文字："回到聊天室"
  - 背景：#3B6E98
  - 點擊後執行 `liff.closeWindow()`

---

## 卦象圖片生成規格

### 圖片尺寸
- 畫布大小：500x500 px（邏輯尺寸）
- 實際渲染：5000x5000 px（scale = 10）
- 輸出格式：PNG
- 背景色：#D2D2D2

### 棋子位置（十字排列）

```
        【棋子4】
           ↑
           |
【棋子2】← 【棋子1】→ 【棋子3】
           |
           ↓
        【棋子5】
```

**座標（邏輯尺寸）**:
| 位置 | x | y | 說明 |
|------|---|---|------|
| 棋子1（中） | 250 | 300 | 中心 |
| 棋子2（左） | 130 | 300 | 左側 |
| 棋子3（右） | 370 | 300 | 右側 |
| 棋子4（上） | 250 | 180 | 上方 |
| 棋子5（下） | 250 | 420 | 下方 |

### 棋子樣式
- 圓形背景：白色（#FFFFFF）
- 半徑：45px
- 邊框：3px，顏色依紅/黑棋
- 文字：
  - 字體：Microsoft YaHei（微軟正黑體）
  - 大小：50px
  - 粗體：bold
  - 顏色：依紅/黑棋
  - 對齊：居中

### 問題文字（頂部）
- 位置：y=25（頂部）
- 字體：Microsoft YaHei
- 大小：35px
- 粗體：bold
- 顏色：黑色
- 對齊：居中
- 最大寬度：450px
- 支援換行（超過最大寬度自動換行）

### 文字換行邏輯

```javascript
function drawWrappedText(ctx, text, x, y, maxWidth, lineHeight) {
  const words = text.split('');
  let line = '';
  let yOffset = y;
  
  for (let n = 0; n < words.length; n++) {
    const testLine = line + words[n];
    const metrics = ctx.measureText(testLine);
    const testWidth = metrics.width;
    
    if (testWidth > maxWidth && n > 0) {
      ctx.fillText(line, x, yOffset);
      line = words[n];
      yOffset += lineHeight;
    } else {
      line = testLine;
    }
  }
  ctx.fillText(line, x, yOffset);
}
```

---

## Flex Message 設計

### 開始抽卦 Flex Message

**視覺規格**:
- Size: kilo（緊湊型）
- Header 背景：#3B6E98（品牌藍）
- Body 背景：白色
- Footer 按鈕：#3B6E98

**內容結構**:
```
┌─────────────────────────┐
│  ✨ 準備抽卦囉           │  ← Header (#3B6E98)
├─────────────────────────┤
│  感謝您完成預約！        │
│                         │
│  請點擊下方按鈕開始抽卦， │
│  系統將引導您：          │
│                         │
│  ┌───────────────────┐  │
│  │ 1️⃣ 輸入您的問題   │  │
│  │    （30字內）     │  │
│  │ 2️⃣ 輸入5個數字    │  │
│  │    進行抽卦       │  │
│  │ 3️⃣ 查看您的卦象   │  │
│  │    結果           │  │
│  └───────────────────┘  │
├─────────────────────────┤
│  【🎲 開始抽卦】         │  ← Button (#3B6E98)
└─────────────────────────┘
```

**JSON 結構**:
- 完整 JSON 參考計劃中的 "節點 11 - Build Flex Message"
- URI: `https://liff.line.me/2008987238-9DfMVogB?taskId={taskId}`

---

## 響應式設計

### 手機版（主要）
- 寬度：100%
- 最大寬度：500px
- 間距：20px
- 按鈕高度：50px
- 字體大小：16px（正文）、20px（標題）

### 桌面版（次要）
- 寬度：500px 固定
- 居中顯示
- 其他同手機版

---

## 字體設定

### 前端（LIFF）
```css
body {
  font-family: -apple-system, BlinkMacSystemFont, "Microsoft YaHei", 
               "微軟正黑體", "Segoe UI", sans-serif;
}
```

### 後端（Canvas）
```javascript
ctx.font = 'bold 50px "Microsoft YaHei", "微軟正黑體", sans-serif';
```

---

## Loading 動畫

### CSS Spinner
```css
.spinner {
  border: 4px solid #f3f3f3;
  border-top: 4px solid #3B6E98;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
```

---

## 可訪問性（Accessibility）

### ARIA 標籤
- 按鈕：`aria-label`
- Loading：`aria-live="polite"`
- 錯誤訊息：`role="alert"`

### 鍵盤導航
- Tab 順序符合邏輯
- Enter 鍵可觸發按鈕

### 顏色對比
- 文字與背景對比度 ≥ 4.5:1（WCAG AA）
- 按鈕顏色清晰可辨

---

## 變更歷史

| 日期 | 版本 | 變更內容 |
|------|------|----------|
| 2026-02-02 | 1.0 | 初始設計規格 |
